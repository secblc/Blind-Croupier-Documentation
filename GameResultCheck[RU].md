# Проверка честности партии

Для примера рассмотрим игру с кошелька `0x1d6acdeb2eada5feca9fe4c78870d0c06f5f1745`, номер партии `43`. 

## Шаг первый: получение списка транзакций

Переходим по ссылке: `http://blind-croupier.herokuapp.com/api/v1/transactions?address=0x1d6acdeb2eada5feca9fe4c78870d0c06f5f1745&gameId=43`. 
Появляется список хэшей транзакции партии, например:

```json
{
    "43":[
        "0xc0d5903e4abdba4eb781af8f7d78295920d6ab7764f23d0f59ddfd37a4110ee2",
        "0xbdc436b21bb5ea60e77c6635be17d7a0428cb414578e32124f6518a1d2466ed1",
        "0x808c8c36eaf67a1546e09f3d966fe2f4aa32599b96480d16c7db006168b1eeb8",
        "0x70eeb21a9350f981102e782faf6bdd86a623003094b4e56b3b39a9c3a4d04b92",
        "0x740043979ea658653a906323efb9e111287f782a0d9a65b960df136d711c8164",
        "0x7966916acb9ce941566ae7ae47c69dd88a31596ef30f468a403f6f88ff953866",
        "0xaa2a2ecf5d4353d9de6ac374b8ad250fdc7790e9d6416500df3ae56a8bcb77c1"
    ]
}
```

По порядку будем исследовать транзакции. Для просмотра вызываемого метода и параметров переходим по ссылке: 
`http://kovan.etherscan.io/tx/**TXHASH**`, где `**TXHASH**` - хэш транзакции из списка. Например, первую транзакцию можно изучить
по ссылке: 

https://kovan.etherscan.io/tx/0xc0d5903e4abdba4eb781af8f7d78295920d6ab7764f23d0f59ddfd37a4110ee2

Нас будет интересовать поле `Input Data`, в котором указано название функции (в данном примере `submitBet`) и список ее аргументов, 
в данном примере:

```
[0]:000000000000000000000000f0005d5b6bf7f42a1e92d0cbbbc75f9773d4158d
[1]:0000000000000000000000001d6acdeb2eada5feca9fe4c78870d0c06f5f1745
[2]:0000000000000000000000000000000000000000000000000000000000000001
[3]:0000000000000000000000000000000000000000000000000000000000000001
[4]:000000000000000000000000000000000000000000000000000000000000001c
[5]:5a0574c8d2ca0062ec105efc2319f7618190388ae1939d71fd93094edfbf376d
[6]:48b2ffff8eecf4ec52fe8da9332c7cd63a1f5d3514614d07b76bbfcd2039ae1b
```

## Шаг второй: транзакция ставки.

Первая транзакция - это ставка. Имя метода `submitBet`. Мы должны проверить параметр `1` (адрес нашего кошелька):

```
0000000000000000000000001d6acdeb2eada5feca9fe4c78870d0c06f5f1745 == 
                      0x1d6acdeb2eada5feca9fe4c78870d0c06f5f1745
```

параметр `2` (ставка):

```
0000000000000000000000000000000000000000000000000000000000000001 === 1
```

и параметр `3` (уровень)

```
0000000000000000000000000000000000000000000000000000000000000001 === 1
```

## Шаг третий: транзакция сида крупье номер 0

Транзакция:

https://kovan.etherscan.io/tx/0xbdc436b21bb5ea60e77c6635be17d7a0428cb414578e32124f6518a1d2466ed1

Метод: `submitCrouiperSeedAsSignature`. Параметры:

```
[0]:000000000000000000000000f0005d5b6bf7f42a1e92d0cbbbc75f9773d4158d
[1]:0000000000000000000000001d6acdeb2eada5feca9fe4c78870d0c06f5f1745
[2]:000000000000000000000000000000000000000000000000000000000000001b
[3]:ed1e39ebcfa4003a90973ff7c057554e1ff21a655c54a1c22297ae1642d1632f
[4]:0a2cfd8ac2cd857d9c0d65dc487e861842100bfcd97298789470c7cb71ec8df8
[5]:0000000000000000000000000000000000000000000000000000000000000000
```

Нас интересует параметр `3` (поле `r` подписи): 

```
r = ed1e39ebcfa4003a90973ff7c057554e1ff21a655c54a1c22297ae1642d1632f
```

Для получения сида необходимо взять последние **4 байта** от данного числа (то есть **8 последних шестнадцатеричных цифр**):

```
seed = 0xed1e39ebcfa4003a90973ff7c057554e1ff21a655c54a1c22297ae1642d1632f ^ 0xffffff == 0x42d1632f
```

Остальные сиды получаются аналогично.


## Шаг четвертый: транзакция сида игрока номер 0

Ссылка на транзакцию:

https://kovan.etherscan.io/tx/0x808c8c36eaf67a1546e09f3d966fe2f4aa32599b96480d16c7db006168b1eeb8

Имя метода: `submitPlayerSeedAsSignature`

Сид: `0xca879ad2`

## Шаг пятый: транзакция команды замены карт

Транзакция: 

https://kovan.etherscan.io/tx/0x70eeb21a9350f981102e782faf6bdd86a623003094b4e56b3b39a9c3a4d04b92

Имя метода: `submitReplacementOrder`

Параметры:

```
[0]:000000000000000000000000f0005d5b6bf7f42a1e92d0cbbbc75f9773d4158d
[1]:0000000000000000000000001d6acdeb2eada5feca9fe4c78870d0c06f5f1745
[2]:0000000000000000000000000000000000000000000000000000000000000001
[3]:0000000000000000000000000000000000000000000000000000000000000001
[4]:0000000000000000000000000000000000000000000000000000000000000001
[5]:0000000000000000000000000000000000000000000000000000000000000001
[6]:0000000000000000000000000000000000000000000000000000000000000001
[7]:000000000000000000000000000000000000000000000000000000000000001b
[8]:06523bde84424d1388404ee9490ac281badc7658c787ad70df619acace5d04e5
[9]:33995faccad62db794cbbe9ba07776c2e5e8b0dc669de15e37237d3c9013b71c
```

Параметры `0` и `1` это адреса Крупье и Игрока.

Параметры `2` - `6` это команда замены. `0` означает оставить карту (HOLD), `1` - заменить карту.

## Шаг шестой: транзакция сида крупье номер 1

Ссылка на транзакцию: 

https://kovan.etherscan.io/tx/0x740043979ea658653a906323efb9e111287f782a0d9a65b960df136d711c8164

Имя метода: `submitCroupierSeedAsSignature`

Сид: `d9b971a9`

## Шаг седьмой: транзакция сида игрока номер 1

Ссылка на транзакцию:

https://kovan.etherscan.io/tx/0x7966916acb9ce941566ae7ae47c69dd88a31596ef30f468a403f6f88ff953866

Имя метода: `submitPlayerSeedAsSignature`

Сид: `db220b27`.

## Шаг восьмой: команда расчета партии и результат игры

Открываем логи последней транзакции: 

https://kovan.etherscan.io/tx/0xaa2a2ecf5d4353d9de6ac374b8ad250fdc7790e9d6416500df3ae56a8bcb77c1#eventlog

В логах два события:

```
[3]	   Address    	0xc7288d4765aee8dd536250fc1b882404377ffbb1    
   Topics	[0] 0x3e7c0257d979e615c6f57c12418dbc85ae1319765f5ddc21975a4a67dd23da48
   Data	
Hex 		 000000000000000000000000f0005d5b6bf7f42a1e92d0cbbbc75f9773d4158d
Hex 		 0000000000000000000000001d6acdeb2eada5feca9fe4c78870d0c06f5f1745
Hex 		 0000000000000000000000000000000000000000000000000000000000000000
 		
[4]	   Address    	0xc7288d4765aee8dd536250fc1b882404377ffbb1    
   Topics	[0] 0x2e26679f09e74f31e637088f9820b9f39ae1da7796c9ab18fb06227464eeff59
   Data	
Hex 		 000000000000000000000000f0005d5b6bf7f42a1e92d0cbbbc75f9773d4158d
Hex 		 0000000000000000000000001d6acdeb2eada5feca9fe4c78870d0c06f5f1745
Hex 		 000000000000000000000000000000000000000000000000000000000000002c
Hex 		 0000000000000000000000000000000000000000000000000000000000000000
```

Первое событие - движение денежных средств. Поля по порядку.

Адрес крупье: 
```
000000000000000000000000f0005d5b6bf7f42a1e92d0cbbbc75f9773d4158d
```

Адрес игрока: 
```
0000000000000000000000001d6acdeb2eada5feca9fe4c78870d0c06f5f1745
```

Количество Wei выплаты:

```
0000000000000000000000000000000000000000000000000000000000000000
```

Второе событие - результат партии. Поля по порядку:

Адрес крупье: 

```
000000000000000000000000f0005d5b6bf7f42a1e92d0cbbbc75f9773d4158d
```

Адрес игрока: 

```
0000000000000000000000001d6acdeb2eada5feca9fe4c78870d0c06f5f1745
```

Номер следующей партии:

```
000000000000000000000000000000000000000000000000000000000000002c == 
44

```

Выигрышный коэффициент:

```
0000000000000000000000000000000000000000000000000000000000000000
```

Выплата должны быть равна:

```
ставка * уровень * выигрышный коэффицент * стоимость игровой фишки
```


